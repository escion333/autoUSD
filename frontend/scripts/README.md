# Circle Developer Controlled Wallets - Scripts

This directory contains utility scripts for setting up and testing Circle Developer Controlled Wallets.

## Setup Scripts

### 1. `generate-entity-secret.ts`
Generates a new 32-byte Entity Secret for securing your wallets.
```bash
npx tsx scripts/generate-entity-secret.ts
```
- Creates a cryptographically secure Entity Secret
- Saves to `.env.local` automatically
- Creates a backup file (`.entity-secret.backup`)
- **Run once** when setting up a new environment

### 2. `register-entity-secret.ts`
Registers your Entity Secret with Circle's API.
```bash
npx tsx scripts/register-entity-secret.ts
```
- Fetches Circle's public key
- Encrypts your Entity Secret
- Registers it with Circle
- Saves recovery file if provided
- **Requires valid Circle API key**

### 3. `test-circle-wallet.ts`
Tests the complete wallet creation flow.
```bash
npx tsx scripts/test-circle-wallet.ts
```
- Initializes Circle client
- Creates a test wallet
- Checks wallet balance
- Verifies all configurations are correct

## Legacy/Alternative Scripts

### `setup-circle.ts`
Interactive setup script with menu options.
```bash
npx tsx scripts/setup-circle.ts
```

### `setup-circle-auto.ts`
Automated version of the setup script (deprecated - use individual scripts above).

## Setup Flow

1. **Get Circle API Key**
   - Sign up at https://console.circle.com
   - Create API key with Developer Controlled Wallets permissions
   - Add to `.env.local` as `CIRCLE_API_KEY`

2. **Generate Entity Secret** (if needed)
   ```bash
   npx tsx scripts/generate-entity-secret.ts
   ```

3. **Register Entity Secret**
   ```bash
   npx tsx scripts/register-entity-secret.ts
   ```

4. **Test Setup**
   ```bash
   npx tsx scripts/test-circle-wallet.ts
   ```

## Environment Variables

Required in `.env.local`:
```env
# From Circle Console
CIRCLE_API_KEY=TEST_API_KEY:xxxxx:yyyyy

# Generated by scripts
CIRCLE_ENTITY_SECRET=<64-char-hex-string>
```

## Security Notes

- **Entity Secret**: Keep secure like a private key
- **API Key**: Never commit to version control
- **Recovery File**: Store securely if generated during registration
- **Backup Files**: Add to `.gitignore`

## Troubleshooting

### 401 Unauthorized
- Check API key is valid (not the placeholder `TEST_API_KEY:...`)
- Ensure API key has correct permissions
- Verify you're using the right environment (testnet vs mainnet)

### Entity Secret Already Registered
- This is fine - you can proceed with wallet creation
- Each API key can only have one Entity Secret registered

### Network Issues
- Check firewall/proxy settings
- Ensure https://api.circle.com is accessible

## Additional Resources

- [Circle Documentation](https://developers.circle.com/w3s/docs)
- [Developer Controlled Wallets Guide](https://developers.circle.com/w3s/developer-controlled-register-entity-secret)
- [Circle Console](https://console.circle.com)